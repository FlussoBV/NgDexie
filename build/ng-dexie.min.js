/**
 * Angularjs wrapper around Dexie.js an IndexedDB handler
 * @version v0.0.21 - build 2017-07-21
 * @link https://github.com/FlussoBV/NgDexie
 * @license Apache License, http://www.apache.org/licenses/
 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ngDexie"),function(a){"use strict";function b(){function b(){return d}var c=this,d={name:"",debug:!1},e=function(){console.error("NgDexie :: No configuration hook has been set!")};c.setOptions=function(b){return d=a.extend({},d,b),c},c.setConfiguration=function(a){return e=a,c},c.$get=["$rootScope","$q","$log","ngDexieUtils",function(d,f,g,h){function i(a){v.close(),v=j(a)}function j(a){var b=new Dexie(a.name);return a.debug&&g.warn("NgDexie :: debug mode enabled"),a.debug&&b.delete().then(function(){g.warn("debug mode :: Database deleted")}),e.call(c,b),b.open().then(function(){b.close(),b.open().then(function(){g.debug("NgDexie :: database is open")})}),b.on("blocked",function(){g.warn("database seems to be blocked")}),b}function k(a,b){var c=f.defer();return v.table(a).get(b).then(c.resolve).catch(c.reject),c.promise}function l(b,c,d){var e=f.defer();return v.table(b).where(c).equals(d).toArray(function(b){a.isArray(b)&&b.length>0?e.resolve(b[0]):e.reject()}),e.promise}function m(b,e){return a.isUndefined(b)?v:(a.isUndefined(e)&&(e=!1),e?d.$apply(function(){b.call(c,v)}):b.call(c,v),v)}function n(a,b){var d=f.defer();return v.transaction("rw",a,function(){b.call(c,v)}).then(function(){d.resolve()}).catch(function(a){d.reject(a)}),d.promise}function o(a){var b=f.defer();return v.table(a).toArray().then(b.resolve).catch(b.reject),b.promise}function p(a,b,c){var d=f.defer();return v.table(a).where(b).equals(c).toArray().then(d.resolve).catch(d.reject),d.promise}function q(a,b){var c=f.defer();return v.table(a).delete(b).then(function(){c.resolve()}).catch(function(a){g.debug("Error while using delete: "+a),c.reject(a)}),c.promise}function r(a,b){var c=f.defer();return v.table(a).put(h.deepClone(b)).then(function(a){c.resolve(a)}).catch(function(a){g.debug("Error while using put: "+a),c.reject(a)}),c.promise}function s(a,b){var c=f.defer();return v.table(a).add(h.deepClone(b)).then(function(a){c.resolve(a)}).catch(function(a){g.debug("Error while using add: "+a),c.reject(a)}),c.promise}function t(a){var b=f.defer();return v.close(),a&&a.call(this,v),v.open().then(function(){b.resolve()}),b.promise}function u(a){var b=f.defer();return v.table(a).clear().then(function(a){b.resolve(a)}).catch(function(a){g.debug("Error while using clear: "+a),b.reject(a)}),b.promise}g.debug("NgDexie :: init");var v=j(b());return{add:s,clear:u,get:k,getByIndex:l,getDb:m,getOptions:b,getTransaction:n,list:o,listByIndex:p,loadDb:i,put:r,remove:q,reopen:t}}]}a.module("ngdexie",["ngdexie.core","ngdexie.ui"]),a.module("ngdexie.core",["ngdexie.utils"]),a.module("ngdexie.core").provider("ngDexie",b)}(angular),function(a){"use strict";function b(){function b(b){var c=Dexie.deepClone(b);return a.isDefined(c.$$hashKey)&&delete c.$$hashKey,c}function c(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}return{deepClone:b,debounce:c}}a.module("ngdexie.utils",["ngdexie.core"]),a.module("ngdexie.utils").factory("ngDexieUtils",b)}(angular),function(a){"use strict";function b(b,c,d,e){function f(f,g,h,i){var j=k._getScope(f),l=e.debounce(function(a,b){d.put(a,b)},1e3);return a.isUndefined(f.$eval(g))?d.get(h,i).then(function(c){b(g).assign(f,c);var e=a.isObject(c),k=function(b){a.isDefined(b)&&l(h,b)};j.watchers[g]=f.$watch(g,k,e),j.dbchanges[g]={table:h,key:i,refresh:function(){d.get(h,i).then(function(a){b(g).assign(f,a)})}}}):c.error("Already binded: "+g),this}function g(a,b){var c=k._getScope(a);c.watchers[b](),delete c.watchers[b],delete c.dbchanges[b]}function h(a){k._removeScope(a)}function i(){d.getDb(function(b){b.on("changes",function(b){a.forEach(b,function(a){j(a.table,a.key)})})})}function j(b,c){a.forEach(k._scopes,function(d){a.forEach(d.dbchanges,function(a){a.table===b&&a.key===c&&a.refresh()})})}var k=this;return k._scopes={},k._getScope=function(b){var c="s"+b.$id;return a.isUndefined(k._scopes[c])&&(k._scopes[c]={watchers:{},dbchanges:{}},b.$on("$destroy",function(){delete k._scopes[c]})),k._scopes[c]},k._removeScope=function(b){var c=k._getScope(b);a.forEach(c.watchers,function(a,c){g(b,c)});var d="s"+b.$id;delete k._scopes[d]},i(),{bind:f,unbind:g,unbindScope:h}}a.module("ngdexie.ui",["ngdexie.core"]),a.module("ngdexie.ui").factory("ngDexieBind",b),b.$inject=["$parse","$log","ngDexie","ngDexieUtils"]}(angular);